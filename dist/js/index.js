require("dotenv").config();var nodemailer=require("nodemailer");const http=require("http"),fs=require("fs"),port=process.env.PORT||5500,server=http.createServer();server.on("request",handleRequest),server.listen(port,(()=>console.log("Server has been started at http://localhost:"+port)));var transporter=nodemailer.createTransport({service:"gmail",auth:{user:process.env.EMAIL,pass:process.env.EMAIL_PASSWORD}});async function handleRequest(e,t){const{method:s,url:r}=e;if("GET"==s)console.log(r),"/"==r?fs.readFile(r.slice(1)||"dist/index.html",((e,s)=>{if(!e)return t.end(s);t.statusCode=404,t.end("File or path not found in "+r)})):fs.readFile("dist"+r,((s,o)=>{if(e.url.endsWith(".svg")&&t.setHeader("Content-Type","image/svg+xml"),e.url.endsWith(".css")&&t.setHeader("Content-Type","text/css"),!s)return t.end(o);t.statusCode=404,t.end("File or path not found in "+r)}));else if("POST"==s){const s=await getBody(e),r=JSON.parse(s);var o={from:process.env.EMAIL,to:["maxpanas008@gmail.com","m.opanasenko1997@gmail.com"],subject:"Newsletter request",text:`Name: ${r.name}, phone: ${r.phone}`};t.setHeader("Content-Type","text/html; charset=utf-8"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","POST, GET, DELETE, OPTIONS, key"),t.setHeader("Access-Control-Allow-Methods","POST, GET, DELETE, OPTIONS"),transporter.sendMail(o,(function(e,r){e?(console.log(e),t.statusCode=400,t.end("Error")):(console.log("Email sent: "+r.response),t.end(s))}))}}async function getBody(e){const t=[];for await(let s of e)t.push(s);return Buffer.concat(t).toString()}